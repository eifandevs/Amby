<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
</head>
<body>
<script type="text/javascript">
const url = getParam("url");
if (url) {
    alert(url);
}

const restoreHistory = getParam("restore");
if (restoreHistory) {
    var data = JSON.parse(unescape(restoreHistory));
    if (data) {
        var urlList = data['history'];
        var currentPage = data['currentPage'];
        history.replaceState({}, "", getRestoreURL(urlList[0]));
        for (var i = 1; i < urlList.length; i++) {
            history.pushState({}, '', getRestoreURL(urlList[i]));
        }
        history.go(currentPage);
        
        setTimeout(() => {
           if (currentPage !== 0) {
               location.reload();
           }
        });
        
        setTimeout(function () {
            webkit.messageHandlers.sessionRestoreHelper.postMessage({ name: "didRestoreSession" });
        }, 0);
    }
}

function getParam(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
</script>
</body>
</html>
